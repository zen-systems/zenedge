# Repository Guidelines

## Project Structure & Module Organization

- `boot/`: early boot + Multiboot entry (`boot/start.s`, `boot/multiboot_header.s`).
- `kernel/`: freestanding kernel code (C + asm).
  - `kernel/arch/`: CPU/interrupt/syscall assembly and i386 platform code.
  - `kernel/mm/`, `kernel/sched/`, `kernel/ipc/`, `kernel/drivers/`: core subsystems.
  - `kernel/lib/wasm3/`: embedded wasm3 runtime sources.
  - `kernel/include/`: minimal “libc-like” headers used by freestanding code.
- `bridge/`: Python “bridge” that talks to the kernel via ivshmem (shared memory IPC).
- `iso/`: GRUB ISO staging directory (generated by the build).
- Root: `linker.ld`, `Makefile`, test runners like `run_bridge_test.sh`.

## Build, Test, and Development Commands

- `make` or `make -j`: builds `zenedge.iso` (default target).
- `make zenedge.bin`: builds the ELF kernel binary only.
- `make run`: boots the ISO in QEMU (`qemu-system-i386 -cdrom zenedge.iso`).
- `make run-serial`: boots with serial on stdio (`-serial stdio -display none`).
- `make run-direct`: boots the kernel directly (`-kernel zenedge.bin`).
- `./scripts/run_qemu.sh`: QEMU launcher with ivshmem setup (Linux `/dev/shm`).
- `./run_bridge_test.sh`, `./run_gym_test.sh`, `./run_mesh_test.sh`: integration tests for ivshmem + Python bridge.

## Coding Style & Naming Conventions

- C is `gnu99`, freestanding: avoid libc calls; prefer `kernel/lib/` helpers.
- Use fixed-width integers for ABI/IPC (`uint32_t`, `uint64_t`, `uintptr_t`).
- Naming: `snake_case` for functions/vars, `UPPER_SNAKE_CASE` for macros, `*_t` for typedefs.
- Keep changes minimal and avoid drive-by formatting; match the surrounding file’s indentation/bracing.

## Testing Guidelines

- No unit test framework in-tree; rely on QEMU boot logs and the integration scripts above.
- When changing IPC/ivshmem, include a short log excerpt (from `qemu_*.log` / `bridge_*.log`) in your PR.

## Commit & Pull Request Guidelines

- Prefer Conventional Commit-style prefixes when possible (e.g., `feat:`, `fix:`, `refactor:`), but keep messages short and specific.
- PRs should include: what changed, how to reproduce (exact command), and any QEMU/bridge logs needed to validate.

## Architecture Notes (Agent-Specific)

- See `agents.md` for the x86_64 port playbook and milestone checklist; keep arch-specific work isolated and avoid breaking the i386 build until x86_64 boots.
