ZE>PSVMHH
KM
ZENEDGE kernel booting...
AI + Edge Computing Kernel Playground

[time] initializing time subsystem
[time] using assumed 1000 MHz CPU frequency
[time] init complete
[trace] flight recorder initialized (256 event ring buffer)
[pmm] initializing physical memory manager
[pmm] mboot at 0x00009500, flags=0x0000024F
[pmm] parsing memory map...
[pmm] found 6 memory regions
[pmm] kernel: phys 0x00100000 - 0x0011A000
[pmm] NUMA node 0: PFN 256-16496 (16214 free)
[pmm] NUMA node 1: PFN 16496-32736 (16240 free)
[pmm] total memory: 130944 KB (32736 pages)
[pmm] free memory: 129816 KB (32454 pages)
[pmm] init complete
[vmm] initializing virtual memory manager
[vmm] current page directory at 0x00101000
[vmm] paging enabled, kernel at 0xC0000000 (boot mapped 128MB using PSE)
[vmm] init complete
[gdt] initializing GDT with TSS...
[gdt] GDT loaded, TSS installed
[idt] initializing IDT...
[idt] IDT loaded with 32 exceptions + 16 IRQs + syscall
[pic] remapping IRQs to vectors 32-47...
[pic] PIC initialized, all IRQs masked
[pit] configuring timer at 100 Hz
[pit] timer configured, IRQ0 unmasked
[keyboard] initialized
[kmain] enabling interrupts...
[syscall] registering syscall handler on vector 128
[pci] Scanning Bus 0...
[pci] Found 0x00008086:0x00001237 at 0:0.0 (Class 0x00000006)
[pci] Found 0x00008086:0x00007000 at 0:1.0 (Class 0x00000006)
[pci] Found 0x00008086:0x00007010 at 0:1.1 (Class 0x00000001)
[pci] Found 0x00008086:0x00007113 at 0:1.3 (Class 0x00000006)
[pci] Found 0x00001234:0x00001111 at 0:2.0 (Class 0x00000003)
[pci] Found 0x00008086:0x0000100E at 0:3.0 (Class 0x00000002)
[pci] Found 0x00001AF4:0x00001110 at 0:4.0 (Class 0x00000005)
[ivshmem] Found device at 0:4.0
[ivshmem] IRQ: 0
[ivshmem] ISR registered on vector 32
[ivshmem] Shared Memory Phys: 0xFE000000 Size: 1048576 bytes
[ivshmem] Mapped to Virt: 0xE0000000
[ipc] initializing proxy driver...
[ipc] cmd ring at 0xE0000000
[ipc] rsp ring at 0xE0008000
[ipc] doorbell at 0xE0010000
[ipc] cmd ring at 0xE0000000
[ipc] rsp ring at 0xE0008000
[ipc] doorbell at 0xE0010000
[heap] initializing shared heap at 0xE0010100
[heap] initialized: 956KB, 15296 blocks
[ipc] Warning: Invalid IRQ, polling mode only.
[ipc] initialized mesh table
[ipc] joined mesh as Node 0

--- IPC Inference Demo ---
[test] Allocated input tensor: id=1
[test] Sending CMD_RUN_MODEL...
[test] Polling for response...
[ipc] response: status=0x00008000 cmd=0x00000010 result=0x00000002
[test] Got response! status=0x00008000 result_blob=0x00000002
[ipc] === DEBUG DUMP ===
[ipc] CMD Ring:
  Magic: 0x51DECA9E (valid)
  Head:  2
  Tail:  2
  Pending: 0 packets
[ipc] RSP Ring:
  Magic: 0x52535030 (valid)
  Head:  2
  Tail:  2
  Pending: 0 responses
[ipc] Doorbell:
  Magic: 0x444F4F52 (valid)
  CMD doorbell: 2 (writes: 1, irqs: 0)
  RSP doorbell: 2 (writes: 2, irqs: 0)
  RSP IRQ enabled: yes
  Local IRQ count: 0
[ipc] === END DUMP ===

--- Shared Heap Demo ---
[test] Allocated raw blob: id=4
[test] Allocated tensor blob: id=5
[test] Wrote 16 floats to tensor
[test] Allocated image tensor: id=8
[heap] === DEBUG DUMP ===
[heap] Magic: 0x48454150 (valid)
[heap] Blocks: 15219/15296 free
[heap] Memory: 4928/978944 bytes used
[heap] Blobs: 4 allocated
  [1] type=1 size=3172 blocks=51
  [4] type=0 size=128 blocks=3
  [5] type=1 size=100 blocks=3
  [8] type=1 size=228 blocks=5
[heap] === END DUMP ===
[test] Freed blob 4
[heap] === DEBUG DUMP ===
[heap] Magic: 0x48454150 (valid)
[heap] Blocks: 15225/15296 free
[heap] Memory: 4544/978944 bytes used
[heap] Blobs: 3 allocated
  [1] type=1 size=3172 blocks=51
  [8] type=1 size=228 blocks=5
  [5] type=1 size=100 blocks=3
[heap] === END DUMP ===

=== MEMORY MAP ===
REGION | BASE       | LENGTH     | TYPE
-------|------------|------------|------------
0      | 0x00000000 | 0x0009FC00 | Available
1      | 0x0009FC00 | 0x00000400 | Reserved
2      | 0x000F0000 | 0x00010000 | Reserved
3      | 0x00100000 | 0x07EE0000 | Available
4      | 0x07FE0000 | 0x00020000 | Reserved
5      | 0xFFFC0000 | 0x00040000 | Reserved

=== NUMA TOPOLOGY ===
Node 0: 64852 KB free / 64960 KB total
Node 1: 64960 KB free / 64960 KB total
=== END MAP ===

[contracts] init
[sched] init

--- Demo 0: Tensor Metadata & Admission Control ---
[test] Job memory metrics:
  total_memory_kb: 12
  peak_memory_kb: 8
  pinned_memory_kb: 4
[contracts] applying contract for job 100
[contracts] priority=HIGH, node=1, cpu_budget=50000us, mem_budget=64KB
[test] Admission check (generous budget):
[admit] checking job 100 against contract for job 100
[admit] job peak memory: 8KB, contract budget: 64KB
[admit] estimated CPU: 5000us, budget: 50000us
[admit] job 100 ADMITTED
  result: OK
[contracts] applying contract for job 101
[contracts] priority=LOW, node=1, cpu_budget=1000us, mem_budget=4KB
[test] Admission check (tight budget):
[admit] checking job 100 against contract for job 101
[admit] job peak memory: 8KB, contract budget: 4KB
[admit] REJECTED: memory budget exceeded
  result: REJECT_MEMORY

--- Demo 1: REALTIME priority job (node 0) ---
[contracts] applying contract for job 1
[contracts] priority=REALTIME, node=0, cpu_budget=5000us, mem_budget=16KB
[test] allocating 5 pages via contract...
  page 0 @ node 0
  page 1 @ node 0
  page 2 @ node 0
  page 3 @ node 0
[contracts] allocation denied: BUDGET EXCEEDED
[contracts] job 1 state: OK -> WARNED
[contracts] Job 1: state=WARNED, cpu=0/5000us, mem=16/16KB
[test] freeing pages...
[sched] run_job begin (budget: 5000us)
[sched] Offloading COMPUTE step 0 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=6491us (Server=8us, Transport=6483us)
[sched] Remote error status: 0x00008001
[sched] BUDGET EXCEED: step 0 took 17517us (limit: 1666us)
[sched] simulating non-compute step 1
[sched] BUDGET EXCEED: step 1 took 4115us (limit: 1666us)
[sched] Offloading COMPUTE step 2 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=2778us (Server=4us, Transport=2774us)
[sched] Remote error status: 0x00008001
[sched] BUDGET EXCEED: step 2 took 12776us (limit: 1666us)
[sched] no ready steps left
[sched] run_job end - 3 steps, 34408us CPU, 3 violations

--- Demo 2: LOW priority job (node 1) ---
[contracts] applying contract for job 2
[contracts] priority=LOW, node=1, cpu_budget=3000us, mem_budget=8KB
[test] allocating 3 pages via LOW contract...
  page 0 @ node 1
  page 1 @ node 1
[contracts] allocation denied: BUDGET EXCEEDED
[contracts] job 2 state: OK -> WARNED
[contracts] Job 2: state=WARNED, cpu=0/3000us, mem=8/8KB
[sched] run_job begin (budget: 3000us)
[sched] Offloading COMPUTE step 0 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=2730us (Server=6us, Transport=2724us)
[sched] Remote error status: 0x00008001
[sched] BUDGET EXCEED: step 0 took 13018us (limit: 1500us)
[sched] Offloading COMPUTE step 1 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=2599us (Server=3us, Transport=2596us)
[sched] Remote error status: 0x00008001
[sched] BUDGET EXCEED: step 1 took 12778us (limit: 1500us)
[sched] no ready steps left
[sched] run_job end - 2 steps, 25796us CPU, 2 violations

--- Demo 3: Distributed Pipeline (Host Acceleration) ---
[demo] Creating multi-stage neural network job...
[contracts] applying contract for job 3
[contracts] priority=HIGH, node=1, cpu_budget=100000us, mem_budget=1024KB
[demo] Submitting pipeline job to scheduler...
[sched] run_job begin (budget: 100000us)
[sched] Offloading COMPUTE step 0 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=2593us (Server=10us, Transport=2583us)
[sched] Remote error status: 0x00008001
[sched] Offloading COMPUTE step 1 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=2644us (Server=5us, Transport=2639us)
[sched] Remote error status: 0x00008001
[sched] Offloading COMPUTE step 2 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=2533us (Server=8us, Transport=2525us)
[sched] Remote error status: 0x00008001
[sched] no ready steps left
[sched] run_job end - 3 steps, 38833us CPU, 0 violations

--- Final Contract States ---
[contracts] Job 1: state=WARNED, cpu=0/5000us, mem=0/16KB
[contracts] Job 2: state=WARNED, cpu=0/3000us, mem=0/8KB

=== FLIGHT RECORDER DUMP ===
TIME(us)     | TYPE             | JOB  | STEP | EXTRA
-------------|------------------|------|------|--------
1290 | BOOT | 0 | 0 | -
8795 | BOOT | 0 | 0 | 0x00007EC6
13159 | BOOT | 0 | 0 | 0x0000C0DE
715832 | CONTRACT_APPLY | 100 | 0 | 0x0000C350
729149 | UNKNOWN | 100 | 8 | 0x00001388
736992 | CONTRACT_APPLY | 101 | 0 | 0x000003E8
747440 | UNKNOWN | 100 | 1 | 0x00000008
759780 | CONTRACT_APPLY | 1 | 0 | 0x00001388
763180 | MEM_ALLOC | 1 | 0 | 0x00000001
765658 | MEM_ALLOC | 1 | 0 | 0x00000001
768060 | MEM_ALLOC | 1 | 0 | 0x00000001
770438 | MEM_ALLOC | 1 | 0 | 0x00000001
775503 | MEM_EXCEED | 1 | 0 | 0x00000014
778608 | STATE_CHANGE | 1 | 0 | 0x00000001
784474 | MEM_FREE | 1 | 0 | 0x00000001
784538 | MEM_FREE | 1 | 0 | 0x00000001
784564 | MEM_FREE | 1 | 0 | 0x00000001
784587 | MEM_FREE | 1 | 0 | 0x00000001
787231 | JOB_SUBMIT | 1 | 0 | 0x00000003
787600 | STEP_START | 1 | 0 | -
805177 | STEP_END | 1 | 0 | 17517us
808667 | BUDGET_EXCEED | 1 | 0 | 0x0000446D
809143 | STEP_START | 1 | 1 | -
813263 | STEP_END | 1 | 1 | 4115us
815819 | BUDGET_EXCEED | 1 | 1 | 0x00001013
815868 | STEP_START | 1 | 2 | -
828652 | STEP_END | 1 | 2 | 12776us
831190 | BUDGET_EXCEED | 1 | 2 | 0x000031E8
833603 | JOB_COMPLETE | 1 | 0 | -
847109 | CONTRACT_APPLY | 2 | 0 | 0x00000BB8
849627 | MEM_ALLOC | 2 | 1 | 0x00000001
852522 | MEM_ALLOC | 2 | 1 | 0x00000001
857506 | MEM_EXCEED | 2 | 0 | 0x0000000C
859956 | STATE_CHANGE | 2 | 0 | 0x00000001
862612 | MEM_FREE | 2 | 1 | 0x00000001
862640 | MEM_FREE | 2 | 1 | 0x00000001
865115 | JOB_SUBMIT | 2 | 0 | 0x00000002
865126 | STEP_START | 2 | 0 | -
878151 | STEP_END | 2 | 0 | 13018us
880983 | BUDGET_EXCEED | 2 | 0 | 0x000032DA
881006 | STEP_START | 2 | 1 | -
893790 | STEP_END | 2 | 1 | 12778us
896751 | BUDGET_EXCEED | 2 | 1 | 0x000031EA
899059 | JOB_COMPLETE | 2 | 0 | -
914514 | CONTRACT_APPLY | 3 | 0 | 0x000186A0
919460 | JOB_SUBMIT | 3 | 0 | 0x00000003
919475 | STEP_START | 3 | 0 | -
932532 | STEP_END | 3 | 0 | 13050us
932679 | STEP_START | 3 | 1 | -
945635 | STEP_END | 3 | 1 | 12948us
945654 | STEP_START | 3 | 2 | -
958499 | STEP_END | 3 | 2 | 12835us
960782 | JOB_COMPLETE | 3 | 0 | -
=== END DUMP (53 events) ===


--- Interrupt System Demo ---
[demo] waiting ~500ms for timer ticks...
[demo] timer ticks elapsed: 50 (expected ~50 at 100Hz)

--- Round Robin Scheduler Demo ---
=== KERNEL MESH ===
Node 0: (ME) ALIVE Load=0 Heartbeat=0x00000000
===================
[sched] initializing RR scheduler...
[vmm] new user PD at phys 0x0011E000 (virt 0xC011E000)
[vmm] kernel PD at phys 0x00101000 (virt 0xC0101000)
[vmm] kernel_pd[768] = 0x000000E3, new_pd[768] = 0x000000E3
SWCR3OK
SWCR3OK
[kmain] Scheduler active. Idle loop.
[USER] Hello from User Space!
[USER] Hello from User Space!
[USER] Hello from User Space!
[USER] Hello from User Space!
[USER] Hello from User Space!
[USER] Hello from User Space!
[USER] Hello from User Space!
ZE>PSVMHH
KM
ZENEDGE kernel booting...
AI + Edge Computing Kernel Playground

[time] initializing time subsystem
[time] using assumed 1000 MHz CPU frequency
[time] init complete
[trace] flight recorder initialized (256 event ring buffer)
[pmm] initializing physical memory manager
[pmm] mboot at 0x00009500, flags=0x0000024F
[pmm] parsing memory map...
[pmm] found 6 memory regions
[pmm] kernel: phys 0x00100000 - 0x0011A000
[pmm] NUMA node 0: PFN 256-16496 (16214 free)
[pmm] NUMA node 1: PFN 16496-32736 (16240 free)
[pmm] total memory: 130944 KB (32736 pages)
[pmm] free memory: 129816 KB (32454 pages)
[pmm] init complete
[vmm] initializing virtual memory manager
[vmm] current page directory at 0x00101000
[vmm] paging enabled, kernel at 0xC0000000 (boot mapped 128MB using PSE)
[vmm] init complete
[gdt] initializing GDT with TSS...
[gdt] GDT loaded, TSS installed
[idt] initializing IDT...
[idt] IDT loaded with 32 exceptions + 16 IRQs + syscall
[pic] remapping IRQs to vectors 32-47...
[pic] PIC initialized, all IRQs masked
[pit] configuring timer at 100 Hz
[pit] timer configured, IRQ0 unmasked
[keyboard] initialized
[kmain] enabling interrupts...
[syscall] registering syscall handler on vector 128
[pci] Scanning Bus 0...
[pci] Found 0x00008086:0x00001237 at 0:0.0 (Class 0x00000006)
[pci] Found 0x00008086:0x00007000 at 0:1.0 (Class 0x00000006)
[pci] Found 0x00008086:0x00007010 at 0:1.1 (Class 0x00000001)
[pci] Found 0x00008086:0x00007113 at 0:1.3 (Class 0x00000006)
[pci] Found 0x00001234:0x00001111 at 0:2.0 (Class 0x00000003)
[pci] Found 0x00008086:0x0000100E at 0:3.0 (Class 0x00000002)
[pci] Found 0x00001AF4:0x00001110 at 0:4.0 (Class 0x00000005)
[ivshmem] Found device at 0:4.0
[ivshmem] IRQ: 0
[ivshmem] ISR registered on vector 32
[ivshmem] Shared Memory Phys: 0xFE000000 Size: 1048576 bytes
[ivshmem] Mapped to Virt: 0xE0000000
[ipc] initializing proxy driver...
[ipc] cmd ring at 0xE0000000
[ipc] rsp ring at 0xE0008000
[ipc] doorbell at 0xE0010000
[ipc] cmd ring at 0xE0000000
[ipc] rsp ring at 0xE0008000
[ipc] doorbell at 0xE0010000
[heap] initializing shared heap at 0xE0010100
[heap] initialized: 956KB, 15296 blocks
[ipc] Warning: Invalid IRQ, polling mode only.
[ipc] initialized mesh table
[ipc] joined mesh as Node 0

--- IPC Inference Demo ---
[test] Allocated input tensor: id=1
[test] Sending CMD_RUN_MODEL...
[test] Polling for response...
[ipc] response: status=0x00008000 cmd=0x00000010 result=0x00000002
[test] Got response! status=0x00008000 result_blob=0x00000002
[ipc] === DEBUG DUMP ===
[ipc] CMD Ring:
  Magic: 0x51DECA9E (valid)
  Head:  2
  Tail:  2
  Pending: 0 packets
[ipc] RSP Ring:
  Magic: 0x52535030 (valid)
  Head:  2
  Tail:  1
  Pending: 1 responses
[ipc] Doorbell:
  Magic: 0x444F4F52 (valid)
  CMD doorbell: 2 (writes: 2, irqs: 0)
  RSP doorbell: 2 (writes: 2, irqs: 0)
  RSP IRQ enabled: yes
  Local IRQ count: 0
[ipc] === END DUMP ===

--- Shared Heap Demo ---
[test] Allocated raw blob: id=5
[test] Allocated tensor blob: id=7
[test] Wrote 16 floats to tensor
[test] Allocated image tensor: id=9
[heap] === DEBUG DUMP ===
[heap] Magic: 0x48454150 (valid)
[heap] Blocks: 15168/15296 free
[heap] Memory: 8192/978944 bytes used
[heap] Blobs: 4 allocated
  [1] type=1 size=3172 blocks=51
  [5] type=0 size=128 blocks=3
  [7] type=1 size=100 blocks=3
  [9] type=1 size=228 blocks=5
[heap] === END DUMP ===
[test] Freed blob 5
[heap] === DEBUG DUMP ===
[heap] Magic: 0x48454150 (valid)
[heap] Blocks: 15174/15296 free
[heap] Memory: 7808/978944 bytes used
[heap] Blobs: 3 allocated
  [1] type=1 size=3172 blocks=51
  [9] type=1 size=228 blocks=5
  [7] type=1 size=100 blocks=3
[heap] === END DUMP ===

=== MEMORY MAP ===
REGION | BASE       | LENGTH     | TYPE
-------|------------|------------|------------
0      | 0x00000000 | 0x0009FC00 | Available
1      | 0x0009FC00 | 0x00000400 | Reserved
2      | 0x000F0000 | 0x00010000 | Reserved
3      | 0x00100000 | 0x07EE0000 | Available
4      | 0x07FE0000 | 0x00020000 | Reserved
5      | 0xFFFC0000 | 0x00040000 | Reserved

=== NUMA TOPOLOGY ===
Node 0: 64852 KB free / 64960 KB total
Node 1: 64960 KB free / 64960 KB total
=== END MAP ===

[contracts] init
[sched] init

--- Demo 0: Tensor Metadata & Admission Control ---
[test] Job memory metrics:
  total_memory_kb: 12
  peak_memory_kb: 8
  pinned_memory_kb: 4
[contracts] applying contract for job 100
[contracts] priority=HIGH, node=1, cpu_budget=50000us, mem_budget=64KB
[test] Admission check (generous budget):
[admit] checking job 100 against contract for job 100
[admit] job peak memory: 8KB, contract budget: 64KB
[admit] estimated CPU: 5000us, budget: 50000us
[admit] job 100 ADMITTED
  result: OK
[contracts] applying contract for job 101
[contracts] priority=LOW, node=1, cpu_budget=1000us, mem_budget=4KB
[test] Admission check (tight budget):
[admit] checking job 100 against contract for job 101
[admit] job peak memory: 8KB, contract budget: 4KB
[admit] REJECTED: memory budget exceeded
  result: REJECT_MEMORY

--- Demo 1: REALTIME priority job (node 0) ---
[contracts] applying contract for job 1
[contracts] priority=REALTIME, node=0, cpu_budget=5000us, mem_budget=16KB
[test] allocating 5 pages via contract...
  page 0 @ node 0
  page 1 @ node 0
  page 2 @ node 0
  page 3 @ node 0
[contracts] allocation denied: BUDGET EXCEEDED
[contracts] job 1 state: OK -> WARNED
[contracts] Job 1: state=WARNED, cpu=0/5000us, mem=16/16KB
[test] freeing pages...
[sched] run_job begin (budget: 5000us)
[sched] Offloading COMPUTE step 0 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=4858us (Server=8us, Transport=4850us)
[sched] Remote error status: 0x00008001
[sched] BUDGET EXCEED: step 0 took 18253us (limit: 1666us)
[sched] simulating non-compute step 1
[sched] BUDGET EXCEED: step 1 took 4909us (limit: 1666us)
[sched] Offloading COMPUTE step 2 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=3193us (Server=6us, Transport=3187us)
[sched] Remote error status: 0x00008001
[sched] BUDGET EXCEED: step 2 took 17389us (limit: 1666us)
[sched] no ready steps left
[sched] run_job end - 3 steps, 40551us CPU, 3 violations

--- Demo 2: LOW priority job (node 1) ---
[contracts] applying contract for job 2
[contracts] priority=LOW, node=1, cpu_budget=3000us, mem_budget=8KB
[test] allocating 3 pages via LOW contract...
  page 0 @ node 1
  page 1 @ node 1
[contracts] allocation denied: BUDGET EXCEEDED
[contracts] job 2 state: OK -> WARNED
[contracts] Job 2: state=WARNED, cpu=0/3000us, mem=8/8KB
[sched] run_job begin (budget: 3000us)
[sched] Offloading COMPUTE step 0 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=3484us (Server=9us, Transport=3475us)
[sched] Remote error status: 0x00008001
[sched] BUDGET EXCEED: step 0 took 18244us (limit: 1500us)
[sched] Offloading COMPUTE step 1 to Bridge...
[ipc] response: status=0x00008000 cmd=0x00000010 result=0x0000000C
[sched] Step complete. Result: 0x0000000C
[sched] Latency Breakdown: Total=4709us (Server=556us, Transport=4153us)
[sched] BUDGET EXCEED: step 1 took 15094us (limit: 1500us)
[sched] no ready steps left
[sched] run_job end - 2 steps, 33338us CPU, 2 violations

--- Demo 3: Distributed Pipeline (Host Acceleration) ---
[demo] Creating multi-stage neural network job...
[contracts] applying contract for job 3
[contracts] priority=HIGH, node=1, cpu_budget=100000us, mem_budget=1024KB
[demo] Submitting pipeline job to scheduler...
[sched] run_job begin (budget: 100000us)
[sched] Offloading COMPUTE step 0 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=4165us (Server=9us, Transport=4156us)
[sched] Remote error status: 0x00008001
[sched] Offloading COMPUTE step 1 to Bridge...
[ipc] response: status=0x00008000 cmd=0x00000010 result=0x0000000E
[sched] Step complete. Result: 0x0000000E
[sched] Latency Breakdown: Total=3483us (Server=428us, Transport=3055us)
[sched] Offloading COMPUTE step 2 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=4467us (Server=1809us, Transport=2658us)
[sched] Remote error status: 0x00008001
[sched] no ready steps left
[sched] run_job end - 3 steps, 49420us CPU, 0 violations

--- Final Contract States ---
[contracts] Job 1: state=WARNED, cpu=0/5000us, mem=0/16KB
[contracts] Job 2: state=WARNED, cpu=0/3000us, mem=0/8KB

=== FLIGHT RECORDER DUMP ===
TIME(us)     | TYPE             | JOB  | STEP | EXTRA
-------------|------------------|------|------|--------
1272 | BOOT | 0 | 0 | -
8560 | BOOT | 0 | 0 | 0x00007EC6
11818 | BOOT | 0 | 0 | 0x0000C0DE
340272 | CONTRACT_APPLY | 100 | 0 | 0x0000C350
356769 | UNKNOWN | 100 | 8 | 0x00001388
365685 | CONTRACT_APPLY | 101 | 0 | 0x000003E8
378850 | UNKNOWN | 100 | 1 | 0x00000008
393742 | CONTRACT_APPLY | 1 | 0 | 0x00001388
397108 | MEM_ALLOC | 1 | 0 | 0x00000001
400034 | MEM_ALLOC | 1 | 0 | 0x00000001
403056 | MEM_ALLOC | 1 | 0 | 0x00000001
405907 | MEM_ALLOC | 1 | 0 | 0x00000001
412173 | MEM_EXCEED | 1 | 0 | 0x00000014
415548 | STATE_CHANGE | 1 | 0 | 0x00000001
422794 | MEM_FREE | 1 | 0 | 0x00000001
422848 | MEM_FREE | 1 | 0 | 0x00000001
422874 | MEM_FREE | 1 | 0 | 0x00000001
422901 | MEM_FREE | 1 | 0 | 0x00000001
426777 | JOB_SUBMIT | 1 | 0 | 0x00000003
427295 | STEP_START | 1 | 0 | -
445608 | STEP_END | 1 | 0 | 18253us
449469 | BUDGET_EXCEED | 1 | 0 | 0x0000474D
449940 | STEP_START | 1 | 1 | -
454855 | STEP_END | 1 | 1 | 4909us
457964 | BUDGET_EXCEED | 1 | 1 | 0x0000132D
458020 | STEP_START | 1 | 2 | -
475417 | STEP_END | 1 | 2 | 17389us
478642 | BUDGET_EXCEED | 1 | 2 | 0x000043ED
481642 | JOB_COMPLETE | 1 | 0 | -
499707 | CONTRACT_APPLY | 2 | 0 | 0x00000BB8
502827 | MEM_ALLOC | 2 | 1 | 0x00000001
506097 | MEM_ALLOC | 2 | 1 | 0x00000001
511865 | MEM_EXCEED | 2 | 0 | 0x0000000C
514770 | STATE_CHANGE | 2 | 0 | 0x00000001
517964 | MEM_FREE | 2 | 1 | 0x00000001
517991 | MEM_FREE | 2 | 1 | 0x00000001
521046 | JOB_SUBMIT | 2 | 0 | 0x00000002
521056 | STEP_START | 2 | 0 | -
539309 | STEP_END | 2 | 0 | 18244us
542404 | BUDGET_EXCEED | 2 | 0 | 0x00004744
542418 | STEP_START | 2 | 1 | -
557520 | STEP_END | 2 | 1 | 15094us
560718 | BUDGET_EXCEED | 2 | 1 | 0x00003AF6
563427 | JOB_COMPLETE | 2 | 0 | -
583139 | CONTRACT_APPLY | 3 | 0 | 0x000186A0
589316 | JOB_SUBMIT | 3 | 0 | 0x00000003
589326 | STEP_START | 3 | 0 | -
606296 | STEP_END | 3 | 0 | 16961us
606433 | STEP_START | 3 | 1 | -
620917 | STEP_END | 3 | 1 | 14478us
620938 | STEP_START | 3 | 2 | -
638926 | STEP_END | 3 | 2 | 17981us
641755 | JOB_COMPLETE | 3 | 0 | -
=== END DUMP (53 events) ===


--- Interrupt System Demo ---
[demo] waiting ~500ms for timer ticks...
[demo] timer ticks elapsed: 50 (expected ~50 at 100Hz)

--- Round Robin Scheduler Demo ---
=== KERNEL MESH ===
Node 0: (ME) ALIVE Load=0 Heartbeat=0x00000000
===================
[sched] initializing RR scheduler...
[vmm] new user PD at phys 0x0011E000 (virt 0xC011E000)
[vmm] kernel PD at phys 0x00101000 (virt 0xC0101000)
[vmm] kernel_pd[768] = 0x000000E3, new_pd[768] = 0x000000E3
SWCR3OK
SWCR3OK
[kmain] Scheduler active. Idle loop.
[USER] Hello from User Space!
[USER] Hello from User Space!
[USER] Hello from User Space!
[USER] Hello from User Space!
[USER] Hello from User Space!
[USER] Hello from User Space!
[USER] Hello from User Space!
ZE>PSVMHH
KM
ZENEDGE kernel booting...
AI + Edge Computing Kernel Playground

[time] initializing time subsystem
[time] using assumed 1000 MHz CPU frequency
[time] init complete
[trace] flight recorder initialized (256 event ring buffer)
[pmm] initializing physical memory manager
[pmm] mboot at 0x00009500, flags=0x0000024F
[pmm] parsing memory map...
[pmm] found 6 memory regions
[pmm] kernel: phys 0x00100000 - 0x0011A000
[pmm] NUMA node 0: PFN 256-16496 (16214 free)
[pmm] NUMA node 1: PFN 16496-32736 (16240 free)
[pmm] total memory: 130944 KB (32736 pages)
[pmm] free memory: 129816 KB (32454 pages)
[pmm] init complete
[vmm] initializing virtual memory manager
[vmm] current page directory at 0x00101000
[vmm] paging enabled, kernel at 0xC0000000 (boot mapped 128MB using PSE)
[vmm] init complete
[gdt] initializing GDT with TSS...
[gdt] GDT loaded, TSS installed
[idt] initializing IDT...
[idt] IDT loaded with 32 exceptions + 16 IRQs + syscall
[pic] remapping IRQs to vectors 32-47...
[pic] PIC initialized, all IRQs masked
[pit] configuring timer at 100 Hz
[pit] timer configured, IRQ0 unmasked
[keyboard] initialized
[kmain] enabling interrupts...
[syscall] registering syscall handler on vector 128
[pci] Scanning Bus 0...
[pci] Found 0x00008086:0x00001237 at 0:0.0 (Class 0x00000006)
[pci] Found 0x00008086:0x00007000 at 0:1.0 (Class 0x00000006)
[pci] Found 0x00008086:0x00007010 at 0:1.1 (Class 0x00000001)
[pci] Found 0x00008086:0x00007113 at 0:1.3 (Class 0x00000006)
[pci] Found 0x00001234:0x00001111 at 0:2.0 (Class 0x00000003)
[pci] Found 0x00008086:0x0000100E at 0:3.0 (Class 0x00000002)
[pci] Found 0x00001AF4:0x00001110 at 0:4.0 (Class 0x00000005)
[ivshmem] Found device at 0:4.0
[ivshmem] IRQ: 0
[ivshmem] ISR registered on vector 32
[ivshmem] Shared Memory Phys: 0xFE000000 Size: 1048576 bytes
[ivshmem] Mapped to Virt: 0xE0000000
[ipc] initializing proxy driver...
[ipc] cmd ring at 0xE0000000
[ipc] rsp ring at 0xE0008000
[ipc] doorbell at 0xE0010000
[ipc] cmd ring at 0xE0000000
[ipc] rsp ring at 0xE0008000
[ipc] doorbell at 0xE0010000
[heap] initializing shared heap at 0xE0010100
[heap] initialized: 956KB, 15296 blocks
[ipc] Warning: Invalid IRQ, polling mode only.
[ipc] initialized mesh table
[ipc] joined mesh as Node 0

--- IPC Inference Demo ---
[test] Allocated input tensor: id=1
[test] Sending CMD_RUN_MODEL...
[test] Polling for response...
[ipc] response: status=0x00008000 cmd=0x00000010 result=0x00000002
[test] Got response! status=0x00008000 result_blob=0x00000002
[ipc] === DEBUG DUMP ===
[ipc] CMD Ring:
  Magic: 0x51DECA9E (valid)
  Head:  1
  Tail:  1
  Pending: 0 packets
[ipc] RSP Ring:
  Magic: 0x52535030 (valid)
  Head:  1
  Tail:  1
  Pending: 0 responses
[ipc] Doorbell:
  Magic: 0x444F4F52 (valid)
  CMD doorbell: 1 (writes: 1, irqs: 0)
  RSP doorbell: 1 (writes: 1, irqs: 0)
  RSP IRQ enabled: yes
  Local IRQ count: 0
[ipc] === END DUMP ===

--- Shared Heap Demo ---
[test] Allocated raw blob: id=6
[test] Allocated tensor blob: id=7
[test] Wrote 16 floats to tensor
[test] Allocated image tensor: id=8
[heap] === DEBUG DUMP ===
[heap] Magic: 0x48454150 (valid)
[heap] Blocks: 15224/15296 free
[heap] Memory: 4608/978944 bytes used
[heap] Blobs: 4 allocated
  [1] type=1 size=3172 blocks=51
  [6] type=0 size=128 blocks=3
  [7] type=1 size=100 blocks=3
  [8] type=1 size=228 blocks=5
[heap] === END DUMP ===
[test] Freed blob 6
[heap] === DEBUG DUMP ===
[heap] Magic: 0x48454150 (valid)
[heap] Blocks: 15227/15296 free
[heap] Memory: 4416/978944 bytes used
[heap] Blobs: 3 allocated
  [1] type=1 size=3172 blocks=51
  [8] type=1 size=228 blocks=5
  [7] type=1 size=100 blocks=3
[heap] === END DUMP ===

=== MEMORY MAP ===
REGION | BASE       | LENGTH     | TYPE
-------|------------|------------|------------
0      | 0x00000000 | 0x0009FC00 | Available
1      | 0x0009FC00 | 0x00000400 | Reserved
2      | 0x000F0000 | 0x00010000 | Reserved
3      | 0x00100000 | 0x07EE0000 | Available
4      | 0x07FE0000 | 0x00020000 | Reserved
5      | 0xFFFC0000 | 0x00040000 | Reserved

=== NUMA TOPOLOGY ===
Node 0: 64852 KB free / 64960 KB total
Node 1: 64960 KB free / 64960 KB total
=== END MAP ===

[contracts] init
[sched] init

--- Demo 0: Tensor Metadata & Admission Control ---
[test] Job memory metrics:
  total_memory_kb: 12
  peak_memory_kb: 8
  pinned_memory_kb: 4
[contracts] applying contract for job 100
[contracts] priority=HIGH, node=1, cpu_budget=50000us, mem_budget=64KB
[test] Admission check (generous budget):
[admit] checking job 100 against contract for job 100
[admit] job peak memory: 8KB, contract budget: 64KB
[admit] estimated CPU: 5000us, budget: 50000us
[admit] job 100 ADMITTED
  result: OK
[contracts] applying contract for job 101
[contracts] priority=LOW, node=1, cpu_budget=1000us, mem_budget=4KB
[test] Admission check (tight budget):
[admit] checking job 100 against contract for job 101
[admit] job peak memory: 8KB, contract budget: 4KB
[admit] REJECTED: memory budget exceeded
  result: REJECT_MEMORY

--- Demo 1: REALTIME priority job (node 0) ---
[contracts] applying contract for job 1
[contracts] priority=REALTIME, node=0, cpu_budget=5000us, mem_budget=16KB
[test] allocating 5 pages via contract...
  page 0 @ node 0
  page 1 @ node 0
  page 2 @ node 0
  page 3 @ node 0
[contracts] allocation denied: BUDGET EXCEEDED
[contracts] job 1 state: OK -> WARNED
[contracts] Job 1: state=WARNED, cpu=0/5000us, mem=16/16KB
[test] freeing pages...
[sched] run_job begin (budget: 5000us)
[sched] Offloading COMPUTE step 0 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=4011us (Server=7us, Transport=4004us)
[sched] Remote error status: 0x00008001
[sched] BUDGET EXCEED: step 0 took 14826us (limit: 1666us)
[sched] simulating non-compute step 1
[sched] BUDGET EXCEED: step 1 took 4226us (limit: 1666us)
[sched] Offloading COMPUTE step 2 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=2648us (Server=6us, Transport=2642us)
[sched] Remote error status: 0x00008001
[sched] BUDGET EXCEED: step 2 took 12762us (limit: 1666us)
[sched] no ready steps left
[sched] run_job end - 3 steps, 31814us CPU, 3 violations

--- Demo 2: LOW priority job (node 1) ---
[contracts] applying contract for job 2
[contracts] priority=LOW, node=1, cpu_budget=3000us, mem_budget=8KB
[test] allocating 3 pages via LOW contract...
  page 0 @ node 1
  page 1 @ node 1
[contracts] allocation denied: BUDGET EXCEEDED
[contracts] job 2 state: OK -> WARNED
[contracts] Job 2: state=WARNED, cpu=0/3000us, mem=8/8KB
[sched] run_job begin (budget: 3000us)
[sched] Offloading COMPUTE step 0 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=2851us (Server=5us, Transport=2846us)
[sched] Remote error status: 0x00008001
[sched] BUDGET EXCEED: step 0 took 12640us (limit: 1500us)
[sched] Offloading COMPUTE step 1 to Bridge...
[ipc] response: status=0x00008000 cmd=0x00000010 result=0x0000000A
[sched] Step complete. Result: 0x0000000A
[sched] Latency Breakdown: Total=2705us (Server=548us, Transport=2157us)
[sched] BUDGET EXCEED: step 1 took 10238us (limit: 1500us)
[sched] no ready steps left
[sched] run_job end - 2 steps, 22878us CPU, 2 violations

--- Demo 3: Distributed Pipeline (Host Acceleration) ---
[demo] Creating multi-stage neural network job...
[contracts] applying contract for job 3
[contracts] priority=HIGH, node=1, cpu_budget=100000us, mem_budget=1024KB
[demo] Submitting pipeline job to scheduler...
[sched] run_job begin (budget: 100000us)
[sched] Offloading COMPUTE step 0 to Bridge...
[ipc] response: status=0x00008000 cmd=0x00000010 result=0x0000000D
[sched] Step complete. Result: 0x0000000D
[sched] Latency Breakdown: Total=2570us (Server=444us, Transport=2126us)
[sched] Offloading COMPUTE step 1 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=2636us (Server=653us, Transport=1983us)
[sched] Remote error status: 0x00008001
[sched] Offloading COMPUTE step 2 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=2686us (Server=712us, Transport=1974us)
[sched] Remote error status: 0x00008001
[sched] no ready steps left
[sched] run_job end - 3 steps, 35304us CPU, 0 violations

--- Final Contract States ---
[contracts] Job 1: state=WARNED, cpu=0/5000us, mem=0/16KB
[contracts] Job 2: state=WARNED, cpu=0/3000us, mem=0/8KB

=== FLIGHT RECORDER DUMP ===
TIME(us)     | TYPE             | JOB  | STEP | EXTRA
-------------|------------------|------|------|--------
1247 | BOOT | 0 | 0 | -
8096 | BOOT | 0 | 0 | 0x00007EC6
11098 | BOOT | 0 | 0 | 0x0000C0DE
309006 | CONTRACT_APPLY | 100 | 0 | 0x0000C350
322585 | UNKNOWN | 100 | 8 | 0x00001388
329971 | CONTRACT_APPLY | 101 | 0 | 0x000003E8
340082 | UNKNOWN | 100 | 1 | 0x00000008
352947 | CONTRACT_APPLY | 1 | 0 | 0x00001388
356023 | MEM_ALLOC | 1 | 0 | 0x00000001
358469 | MEM_ALLOC | 1 | 0 | 0x00000001
360830 | MEM_ALLOC | 1 | 0 | 0x00000001
363214 | MEM_ALLOC | 1 | 0 | 0x00000001
368191 | MEM_EXCEED | 1 | 0 | 0x00000014
370935 | STATE_CHANGE | 1 | 0 | 0x00000001
376726 | MEM_FREE | 1 | 0 | 0x00000001
376780 | MEM_FREE | 1 | 0 | 0x00000001
376805 | MEM_FREE | 1 | 0 | 0x00000001
376828 | MEM_FREE | 1 | 0 | 0x00000001
379493 | JOB_SUBMIT | 1 | 0 | 0x00000003
379892 | STEP_START | 1 | 0 | -
394763 | STEP_END | 1 | 0 | 14826us
397917 | BUDGET_EXCEED | 1 | 0 | 0x000039EA
398389 | STEP_START | 1 | 1 | -
402622 | STEP_END | 1 | 1 | 4226us
405156 | BUDGET_EXCEED | 1 | 1 | 0x00001082
405207 | STEP_START | 1 | 2 | -
417977 | STEP_END | 1 | 2 | 12762us
420499 | BUDGET_EXCEED | 1 | 2 | 0x000031DA
423029 | JOB_COMPLETE | 1 | 0 | -
436147 | CONTRACT_APPLY | 2 | 0 | 0x00000BB8
438689 | MEM_ALLOC | 2 | 1 | 0x00000001
441120 | MEM_ALLOC | 2 | 1 | 0x00000001
446095 | MEM_EXCEED | 2 | 0 | 0x0000000C
448494 | STATE_CHANGE | 2 | 0 | 0x00000001
451078 | MEM_FREE | 2 | 1 | 0x00000001
451104 | MEM_FREE | 2 | 1 | 0x00000001
453595 | JOB_SUBMIT | 2 | 0 | 0x00000002
453604 | STEP_START | 2 | 0 | -
466252 | STEP_END | 2 | 0 | 12640us
468753 | BUDGET_EXCEED | 2 | 0 | 0x00003160
468764 | STEP_START | 2 | 1 | -
479009 | STEP_END | 2 | 1 | 10238us
481587 | BUDGET_EXCEED | 2 | 1 | 0x000027FE
483895 | JOB_COMPLETE | 2 | 0 | -
499193 | CONTRACT_APPLY | 3 | 0 | 0x000186A0
504300 | JOB_SUBMIT | 3 | 0 | 0x00000003
504310 | STEP_START | 3 | 0 | -
514388 | STEP_END | 3 | 0 | 10071us
514515 | STEP_START | 3 | 1 | -
527093 | STEP_END | 3 | 1 | 12570us
527111 | STEP_START | 3 | 2 | -
539781 | STEP_END | 3 | 2 | 12663us
542081 | JOB_COMPLETE | 3 | 0 | -
=== END DUMP (53 events) ===


--- Interrupt System Demo ---
[demo] waiting ~500ms for timer ticks...
[demo] timer ticks elapsed: 50 (expected ~50 at 100Hz)

--- Round Robin Scheduler Demo ---
=== KERNEL MESH ===
Node 0: (ME) ALIVE Load=0 Heartbeat=0x00000000
===================
[sched] initializing RR scheduler...
[vmm] new user PD at phys 0x0011E000 (virt 0xC011E000)
[vmm] kernel PD at phys 0x00101000 (virt 0xC0101000)
[vmm] kernel_pd[768] = 0x000000E3, new_pd[768] = 0x000000E3
SWCR3OK
SWCR3OK
[kmain] Scheduler active. Idle loop.
[USER] Hello from User Space!
[USER] Hello from User Space!
[USER] Hello from User Space!
[USER] Hello from User Space!
[USER] Hello from User Space!
[USER] Hello from User Space!
[USER] Hello from User Space!
ZE>PSVMHH
KM
ZENEDGE kernel booting...
AI + Edge Computing Kernel Playground

[time] initializing time subsystem
[time] using assumed 1000 MHz CPU frequency
[time] init complete
[trace] flight recorder initialized (256 event ring buffer)
[pmm] initializing physical memory manager
[pmm] mboot at 0x00009500, flags=0x0000024F
[pmm] parsing memory map...
[pmm] found 6 memory regions
[pmm] kernel: phys 0x00100000 - 0x0011A000
[pmm] NUMA node 0: PFN 256-16496 (16214 free)
[pmm] NUMA node 1: PFN 16496-32736 (16240 free)
[pmm] total memory: 130944 KB (32736 pages)
[pmm] free memory: 129816 KB (32454 pages)
[pmm] init complete
[vmm] initializing virtual memory manager
[vmm] current page directory at 0x00101000
[vmm] paging enabled, kernel at 0xC0000000 (boot mapped 128MB using PSE)
[vmm] init complete
[gdt] initializing GDT with TSS...
[gdt] GDT loaded, TSS installed
[idt] initializing IDT...
[idt] IDT loaded with 32 exceptions + 16 IRQs + syscall
[pic] remapping IRQs to vectors 32-47...
[pic] PIC initialized, all IRQs masked
[pit] configuring timer at 100 Hz
[pit] timer configured, IRQ0 unmasked
[keyboard] initialized
[kmain] enabling interrupts...
[syscall] registering syscall handler on vector 128
[pci] Scanning Bus 0...
[pci] Found 0x00008086:0x00001237 at 0:0.0 (Class 0x00000006)
[pci] Found 0x00008086:0x00007000 at 0:1.0 (Class 0x00000006)
[pci] Found 0x00008086:0x00007010 at 0:1.1 (Class 0x00000001)
[pci] Found 0x00008086:0x00007113 at 0:1.3 (Class 0x00000006)
[pci] Found 0x00001234:0x00001111 at 0:2.0 (Class 0x00000003)
[pci] Found 0x00008086:0x0000100E at 0:3.0 (Class 0x00000002)
[pci] Found 0x00001AF4:0x00001110 at 0:4.0 (Class 0x00000005)
[ivshmem] Found device at 0:4.0
[ivshmem] IRQ: 0
[ivshmem] ISR registered on vector 32
[ivshmem] Shared Memory Phys: 0xFE000000 Size: 1048576 bytes
[ivshmem] Mapped to Virt: 0xE0000000
[ipc] initializing proxy driver...
[ipc] cmd ring at 0xE0000000
[ipc] rsp ring at 0xE0008000
[ipc] doorbell at 0xE0010000
[ipc] cmd ring at 0xE0000000
[ipc] rsp ring at 0xE0008000
[ipc] doorbell at 0xE0010000
[heap] initializing shared heap at 0xE0010100
[heap] initialized: 956KB, 15296 blocks
[ipc] Warning: Invalid IRQ, polling mode only.
[ipc] initialized mesh table
[ipc] joined mesh as Node 0

--- IPC Inference Demo ---
[test] Allocated input tensor: id=1
[test] Sending CMD_RUN_MODEL...
[test] Polling for response...
[ipc] response: status=0x00008000 cmd=0x00000010 result=0x00000003
[test] Got response! status=0x00008000 result_blob=0x00000003
[ipc] === DEBUG DUMP ===
[ipc] CMD Ring:
  Magic: 0x51DECA9E (valid)
  Head:  2
  Tail:  2
  Pending: 0 packets
[ipc] RSP Ring:
  Magic: 0x52535030 (valid)
  Head:  2
  Tail:  1
  Pending: 1 responses
[ipc] Doorbell:
  Magic: 0x444F4F52 (valid)
  CMD doorbell: 2 (writes: 2, irqs: 0)
  RSP doorbell: 2 (writes: 2, irqs: 0)
  RSP IRQ enabled: yes
  Local IRQ count: 0
[ipc] === END DUMP ===

--- Shared Heap Demo ---
[test] Allocated raw blob: id=5
[test] Allocated tensor blob: id=6
[test] Wrote 16 floats to tensor
[test] Allocated image tensor: id=9
[heap] === DEBUG DUMP ===
[heap] Magic: 0x48454150 (valid)
[heap] Blocks: 15168/15296 free
[heap] Memory: 8192/978944 bytes used
[heap] Blobs: 4 allocated
  [1] type=1 size=3172 blocks=51
  [5] type=0 size=128 blocks=3
  [6] type=1 size=100 blocks=3
  [9] type=1 size=228 blocks=5
[heap] === END DUMP ===
[test] Freed blob 5
[heap] === DEBUG DUMP ===
[heap] Magic: 0x48454150 (valid)
[heap] Blocks: 15174/15296 free
[heap] Memory: 7808/978944 bytes used
[heap] Blobs: 3 allocated
  [1] type=1 size=3172 blocks=51
  [9] type=1 size=228 blocks=5
  [6] type=1 size=100 blocks=3
[heap] === END DUMP ===

=== MEMORY MAP ===
REGION | BASE       | LENGTH     | TYPE
-------|------------|------------|------------
0      | 0x00000000 | 0x0009FC00 | Available
1      | 0x0009FC00 | 0x00000400 | Reserved
2      | 0x000F0000 | 0x00010000 | Reserved
3      | 0x00100000 | 0x07EE0000 | Available
4      | 0x07FE0000 | 0x00020000 | Reserved
5      | 0xFFFC0000 | 0x00040000 | Reserved

=== NUMA TOPOLOGY ===
Node 0: 64852 KB free / 64960 KB total
Node 1: 64960 KB free / 64960 KB total
=== END MAP ===

[contracts] init
[sched] init

--- Demo 0: Tensor Metadata & Admission Control ---
[test] Job memory metrics:
  total_memory_kb: 12
  peak_memory_kb: 8
  pinned_memory_kb: 4
[contracts] applying contract for job 100
[contracts] priority=HIGH, node=1, cpu_budget=50000us, mem_budget=64KB
[test] Admission check (generous budget):
[admit] checking job 100 against contract for job 100
[admit] job peak memory: 8KB, contract budget: 64KB
[admit] estimated CPU: 5000us, budget: 50000us
[admit] job 100 ADMITTED
  result: OK
[contracts] applying contract for job 101
[contracts] priority=LOW, node=1, cpu_budget=1000us, mem_budget=4KB
[test] Admission check (tight budget):
[admit] checking job 100 against contract for job 101
[admit] job peak memory: 8KB, contract budget: 4KB
[admit] REJECTED: memory budget exceeded
  result: REJECT_MEMORY

--- Demo 1: REALTIME priority job (node 0) ---
[contracts] applying contract for job 1
[contracts] priority=REALTIME, node=0, cpu_budget=5000us, mem_budget=16KB
[test] allocating 5 pages via contract...
  page 0 @ node 0
  page 1 @ node 0
  page 2 @ node 0
  page 3 @ node 0
[contracts] allocation denied: BUDGET EXCEEDED
[contracts] job 1 state: OK -> WARNED
[contracts] Job 1: state=WARNED, cpu=0/5000us, mem=16/16KB
[test] freeing pages...
[sched] run_job begin (budget: 5000us)
[sched] Offloading COMPUTE step 0 to Bridge...
[ipc] response: status=0x00008000 cmd=0x00000010 result=0x00000004
[sched] Step complete. Result: 0x00000004
[sched] Latency Breakdown: Total=2752us (Server=266us, Transport=2486us)
[sched] BUDGET EXCEED: step 0 took 11154us (limit: 1666us)
[sched] simulating non-compute step 1
[sched] BUDGET EXCEED: step 1 took 4158us (limit: 1666us)
[sched] Offloading COMPUTE step 2 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=2577us (Server=8us, Transport=2569us)
[sched] Remote error status: 0x00008001
[sched] BUDGET EXCEED: step 2 took 12665us (limit: 1666us)
[sched] no ready steps left
[sched] run_job end - 3 steps, 27977us CPU, 3 violations

--- Demo 2: LOW priority job (node 1) ---
[contracts] applying contract for job 2
[contracts] priority=LOW, node=1, cpu_budget=3000us, mem_budget=8KB
[test] allocating 3 pages via LOW contract...
  page 0 @ node 1
  page 1 @ node 1
[contracts] allocation denied: BUDGET EXCEEDED
[contracts] job 2 state: OK -> WARNED
[contracts] Job 2: state=WARNED, cpu=0/3000us, mem=8/8KB
[sched] run_job begin (budget: 3000us)
[sched] Offloading COMPUTE step 0 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=2773us (Server=8us, Transport=2765us)
[sched] Remote error status: 0x00008001
[sched] BUDGET EXCEED: step 0 took 12601us (limit: 1500us)
[sched] Offloading COMPUTE step 1 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=2913us (Server=9us, Transport=2904us)
[sched] Remote error status: 0x00008001
[sched] BUDGET EXCEED: step 1 took 13031us (limit: 1500us)
[sched] no ready steps left
[sched] run_job end - 2 steps, 25632us CPU, 2 violations

--- Demo 3: Distributed Pipeline (Host Acceleration) ---
[demo] Creating multi-stage neural network job...
[contracts] applying contract for job 3
[contracts] priority=HIGH, node=1, cpu_budget=100000us, mem_budget=1024KB
[demo] Submitting pipeline job to scheduler...
[sched] run_job begin (budget: 100000us)
[sched] Offloading COMPUTE step 0 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=2604us (Server=10us, Transport=2594us)
[sched] Remote error status: 0x00008001
[sched] Offloading COMPUTE step 1 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=2601us (Server=1054us, Transport=1547us)
[sched] Remote error status: 0x00008001
[sched] Offloading COMPUTE step 2 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=2614us (Server=865us, Transport=1749us)
[sched] Remote error status: 0x00008001
[sched] no ready steps left
[sched] run_job end - 3 steps, 37836us CPU, 0 violations

--- Final Contract States ---
[contracts] Job 1: state=WARNED, cpu=0/5000us, mem=0/16KB
[contracts] Job 2: state=WARNED, cpu=0/3000us, mem=0/8KB

=== FLIGHT RECORDER DUMP ===
TIME(us)     | TYPE             | JOB  | STEP | EXTRA
-------------|------------------|------|------|--------
1292 | BOOT | 0 | 0 | -
8352 | BOOT | 0 | 0 | 0x00007EC6
11346 | BOOT | 0 | 0 | 0x0000C0DE
310644 | CONTRACT_APPLY | 100 | 0 | 0x0000C350
324656 | UNKNOWN | 100 | 8 | 0x00001388
332225 | CONTRACT_APPLY | 101 | 0 | 0x000003E8
342302 | UNKNOWN | 100 | 1 | 0x00000008
355935 | CONTRACT_APPLY | 1 | 0 | 0x00001388
358878 | MEM_ALLOC | 1 | 0 | 0x00000001
361352 | MEM_ALLOC | 1 | 0 | 0x00000001
363790 | MEM_ALLOC | 1 | 0 | 0x00000001
366256 | MEM_ALLOC | 1 | 0 | 0x00000001
371386 | MEM_EXCEED | 1 | 0 | 0x00000014
374157 | STATE_CHANGE | 1 | 0 | 0x00000001
379980 | MEM_FREE | 1 | 0 | 0x00000001
380034 | MEM_FREE | 1 | 0 | 0x00000001
380059 | MEM_FREE | 1 | 0 | 0x00000001
380081 | MEM_FREE | 1 | 0 | 0x00000001
382900 | JOB_SUBMIT | 1 | 0 | 0x00000003
383280 | STEP_START | 1 | 0 | -
394489 | STEP_END | 1 | 0 | 11154us
397672 | BUDGET_EXCEED | 1 | 0 | 0x00002B92
398165 | STEP_START | 1 | 1 | -
402330 | STEP_END | 1 | 1 | 4158us
404855 | BUDGET_EXCEED | 1 | 1 | 0x0000103E
404905 | STEP_START | 1 | 2 | -
417577 | STEP_END | 1 | 2 | 12665us
420126 | BUDGET_EXCEED | 1 | 2 | 0x00003179
422627 | JOB_COMPLETE | 1 | 0 | -
435792 | CONTRACT_APPLY | 2 | 0 | 0x00000BB8
438372 | MEM_ALLOC | 2 | 1 | 0x00000001
440834 | MEM_ALLOC | 2 | 1 | 0x00000001
445740 | MEM_EXCEED | 2 | 0 | 0x0000000C
448111 | STATE_CHANGE | 2 | 0 | 0x00000001
450723 | MEM_FREE | 2 | 1 | 0x00000001
450750 | MEM_FREE | 2 | 1 | 0x00000001
453246 | JOB_SUBMIT | 2 | 0 | 0x00000002
453255 | STEP_START | 2 | 0 | -
465862 | STEP_END | 2 | 0 | 12601us
468381 | BUDGET_EXCEED | 2 | 0 | 0x00003139
468394 | STEP_START | 2 | 1 | -
481433 | STEP_END | 2 | 1 | 13031us
483945 | BUDGET_EXCEED | 2 | 1 | 0x000032E7
486335 | JOB_COMPLETE | 2 | 0 | -
501652 | CONTRACT_APPLY | 3 | 0 | 0x000186A0
506728 | JOB_SUBMIT | 3 | 0 | 0x00000003
506739 | STEP_START | 3 | 0 | -
519385 | STEP_END | 3 | 0 | 12638us
519530 | STEP_START | 3 | 1 | -
532179 | STEP_END | 3 | 1 | 12642us
532197 | STEP_START | 3 | 2 | -
544759 | STEP_END | 3 | 2 | 12556us
547156 | JOB_COMPLETE | 3 | 0 | -
=== END DUMP (53 events) ===


--- Interrupt System Demo ---
[demo] waiting ~500ms for timer ticks...
[demo] timer ticks elapsed: 50 (expected ~50 at 100Hz)

--- Round Robin Scheduler Demo ---
=== KERNEL MESH ===
Node 0: (ME) ALIVE Load=0 Heartbeat=0x00000000
Node 1: ALIVE Load=0 Heartbeat=0x00000000
===================
[sched] initializing RR scheduler...
[vmm] new user PD at phys 0x0011E000 (virt 0xC011E000)
[vmm] kernel PD at phys 0x00101000 (virt 0xC0101000)
[vmm] kernel_pd[768] = 0x000000E3, new_pd[768] = 0x000000E3
SWCR3OK
SWCR3OK
[kmain] Scheduler active. Idle loop.
[USER] Hello from User Space!
[USER] Hello from User Space!
[USER] Hello from User Space!
[USER] Hello from User Space!
[USER] Hello from User Space!
[USER] Hello from User Space!
[USER] Hello from User Space!
ZE>PSVMHH
KM
ZENEDGE kernel booting...
AI + Edge Computing Kernel Playground

[time] initializing time subsystem
[time] using assumed 1000 MHz CPU frequency
[time] init complete
[trace] flight recorder initialized (256 event ring buffer)
[pmm] initializing physical memory manager
[pmm] mboot at 0x00009500, flags=0x0000024F
[pmm] parsing memory map...
[pmm] found 6 memory regions
[pmm] kernel: phys 0x00100000 - 0x0011A000
[pmm] NUMA node 0: PFN 256-16496 (16214 free)
[pmm] NUMA node 1: PFN 16496-32736 (16240 free)
[pmm] total memory: 130944 KB (32736 pages)
[pmm] free memory: 129816 KB (32454 pages)
[pmm] init complete
[vmm] initializing virtual memory manager
[vmm] current page directory at 0x00101000
[vmm] paging enabled, kernel at 0xC0000000 (boot mapped 128MB using PSE)
[vmm] init complete
[gdt] initializing GDT with TSS...
[gdt] GDT loaded, TSS installed
[idt] initializing IDT...
[idt] IDT loaded with 32 exceptions + 16 IRQs + syscall
[pic] remapping IRQs to vectors 32-47...
[pic] PIC initialized, all IRQs masked
[pit] configuring timer at 100 Hz
[pit] timer configured, IRQ0 unmasked
[keyboard] initialized
[kmain] enabling interrupts...
[syscall] registering syscall handler on vector 128
[pci] Scanning Bus 0...
[pci] Found 0x00008086:0x00001237 at 0:0.0 (Class 0x00000006)
[pci] Found 0x00008086:0x00007000 at 0:1.0 (Class 0x00000006)
[pci] Found 0x00008086:0x00007010 at 0:1.1 (Class 0x00000001)
[pci] Found 0x00008086:0x00007113 at 0:1.3 (Class 0x00000006)
[pci] Found 0x00001234:0x00001111 at 0:2.0 (Class 0x00000003)
[pci] Found 0x00008086:0x0000100E at 0:3.0 (Class 0x00000002)
[pci] Found 0x00001AF4:0x00001110 at 0:4.0 (Class 0x00000005)
[ivshmem] Found device at 0:4.0
[ivshmem] IRQ: 0
[ivshmem] ISR registered on vector 32
[ivshmem] Shared Memory Phys: 0xFE000000 Size: 1048576 bytes
[ivshmem] Mapped to Virt: 0xE0000000
[ipc] initializing proxy driver...
[ipc] cmd ring at 0xE0000000
[ipc] rsp ring at 0xE0008000
[ipc] doorbell at 0xE0010000
[ipc] cmd ring at 0xE0000000
[ipc] rsp ring at 0xE0008000
[ipc] doorbell at 0xE0010000
[heap] initializing shared heap at 0xE0010100
[heap] initialized: 956KB, 15296 blocks
[ipc] Warning: Invalid IRQ, polling mode only.
[ipc] initialized mesh table
[ipc] joined mesh as Node 0

--- IPC Inference Demo ---
[test] Allocated input tensor: id=1
[test] Sending CMD_RUN_MODEL...
[test] Polling for response...
[ipc] response: status=0x00008000 cmd=0x00000010 result=0x00000002
[test] Got response! status=0x00008000 result_blob=0x00000002
[ipc] === DEBUG DUMP ===
[ipc] CMD Ring:
  Magic: 0x51DECA9E (valid)
  Head:  1
  Tail:  1
  Pending: 0 packets
[ipc] RSP Ring:
  Magic: 0x52535030 (valid)
  Head:  1
  Tail:  1
  Pending: 0 responses
[ipc] Doorbell:
  Magic: 0x444F4F52 (valid)
  CMD doorbell: 1 (writes: 1, irqs: 0)
  RSP doorbell: 1 (writes: 1, irqs: 0)
  RSP IRQ enabled: yes
  Local IRQ count: 0
[ipc] === END DUMP ===

--- Shared Heap Demo ---
[test] Allocated raw blob: id=3
[test] Allocated tensor blob: id=4
[test] Wrote 16 floats to tensor
[test] Allocated image tensor: id=5
[heap] === DEBUG DUMP ===
[heap] Magic: 0x48454150 (valid)
[heap] Blocks: 15232/15296 free
[heap] Memory: 4096/978944 bytes used
[heap] Blobs: 4 allocated
  [1] type=1 size=3172 blocks=51
  [3] type=0 size=128 blocks=3
  [4] type=1 size=100 blocks=3
  [5] type=1 size=228 blocks=5
[heap] === END DUMP ===
[test] Freed blob 3
[heap] === DEBUG DUMP ===
[heap] Magic: 0x48454150 (valid)
[heap] Blocks: 15235/15296 free
[heap] Memory: 3904/978944 bytes used
[heap] Blobs: 3 allocated
  [1] type=1 size=3172 blocks=51
  [5] type=1 size=228 blocks=5
  [4] type=1 size=100 blocks=3
[heap] === END DUMP ===

=== MEMORY MAP ===
REGION | BASE       | LENGTH     | TYPE
-------|------------|------------|------------
0      | 0x00000000 | 0x0009FC00 | Available
1      | 0x0009FC00 | 0x00000400 | Reserved
2      | 0x000F0000 | 0x00010000 | Reserved
3      | 0x00100000 | 0x07EE0000 | Available
4      | 0x07FE0000 | 0x00020000 | Reserved
5      | 0xFFFC0000 | 0x00040000 | Reserved

=== NUMA TOPOLOGY ===
Node 0: 64852 KB free / 64960 KB total
Node 1: 64960 KB free / 64960 KB total
=== END MAP ===

[contracts] init
[sched] init

--- Demo 0: Tensor Metadata & Admission Control ---
[test] Job memory metrics:
  total_memory_kb: 12
  peak_memory_kb: 8
  pinned_memory_kb: 4
[contracts] applying contract for job 100
[contracts] priority=HIGH, node=1, cpu_budget=50000us, mem_budget=64KB
[test] Admission check (generous budget):
[admit] checking job 100 against contract for job 100
[admit] job peak memory: 8KB, contract budget: 64KB
[admit] estimated CPU: 5000us, budget: 50000us
[admit] job 100 ADMITTED
  result: OK
[contracts] applying contract for job 101
[contracts] priority=LOW, node=1, cpu_budget=1000us, mem_budget=4KB
[test] Admission check (tight budget):
[admit] checking job 100 against contract for job 101
[admit] job peak memory: 8KB, contract budget: 4KB
[admit] REJECTED: memory budget exceeded
  result: REJECT_MEMORY

--- Demo 1: REALTIME priority job (node 0) ---
[contracts] applying contract for job 1
[contracts] priority=REALTIME, node=0, cpu_budget=5000us, mem_budget=16KB
[test] allocating 5 pages via contract...
  page 0 @ node 0
  page 1 @ node 0
  page 2 @ node 0
  page 3 @ node 0
[contracts] allocation denied: BUDGET EXCEEDED
[contracts] job 1 state: OK -> WARNED
[contracts] Job 1: state=WARNED, cpu=0/5000us, mem=16/16KB
[test] freeing pages...
[sched] run_job begin (budget: 5000us)
[sched] Offloading COMPUTE step 0 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=5387us (Server=10us, Transport=5377us)
[sched] Remote error status: 0x00008001
[sched] BUDGET EXCEED: step 0 took 16107us (limit: 1666us)
[sched] simulating non-compute step 1
[sched] BUDGET EXCEED: step 1 took 4361us (limit: 1666us)
[sched] Offloading COMPUTE step 2 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=5725us (Server=10us, Transport=5715us)
[sched] Remote error status: 0x00008001
[sched] BUDGET EXCEED: step 2 took 15683us (limit: 1666us)
[sched] no ready steps left
[sched] run_job end - 3 steps, 36151us CPU, 3 violations

--- Demo 2: LOW priority job (node 1) ---
[contracts] applying contract for job 2
[contracts] priority=LOW, node=1, cpu_budget=3000us, mem_budget=8KB
[test] allocating 3 pages via LOW contract...
  page 0 @ node 1
  page 1 @ node 1
[contracts] allocation denied: BUDGET EXCEEDED
[contracts] job 2 state: OK -> WARNED
[contracts] Job 2: state=WARNED, cpu=0/3000us, mem=8/8KB
[sched] run_job begin (budget: 3000us)
[sched] Offloading COMPUTE step 0 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=3321us (Server=10us, Transport=3311us)
[sched] Remote error status: 0x00008001
[sched] BUDGET EXCEED: step 0 took 13449us (limit: 1500us)
[sched] Offloading COMPUTE step 1 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=6738us (Server=10us, Transport=6728us)
[sched] Remote error status: 0x00008001
[sched] BUDGET EXCEED: step 1 took 17125us (limit: 1500us)
[sched] no ready steps left
[sched] run_job end - 2 steps, 30574us CPU, 2 violations

--- Demo 3: Distributed Pipeline (Host Acceleration) ---
[demo] Creating multi-stage neural network job...
[contracts] applying contract for job 3
[contracts] priority=HIGH, node=1, cpu_budget=100000us, mem_budget=1024KB
[demo] Submitting pipeline job to scheduler...
[sched] run_job begin (budget: 100000us)
[sched] Offloading COMPUTE step 0 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=6508us (Server=23us, Transport=6485us)
[sched] Remote error status: 0x00008001
[sched] Offloading COMPUTE step 1 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=5234us (Server=21us, Transport=5213us)
[sched] Remote error status: 0x00008001
[sched] Offloading COMPUTE step 2 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=5329us (Server=20us, Transport=5309us)
[sched] Remote error status: 0x00008001
[sched] no ready steps left
[sched] run_job end - 3 steps, 47436us CPU, 0 violations

--- Final Contract States ---
[contracts] Job 1: state=WARNED, cpu=0/5000us, mem=0/16KB
[contracts] Job 2: state=WARNED, cpu=0/3000us, mem=0/8KB

=== FLIGHT RECORDER DUMP ===
TIME(us)     | TYPE             | JOB  | STEP | EXTRA
-------------|------------------|------|------|--------
1241 | BOOT | 0 | 0 | -
8293 | BOOT | 0 | 0 | 0x00007EC6
11518 | BOOT | 0 | 0 | 0x0000C0DE
354791 | CONTRACT_APPLY | 100 | 0 | 0x0000C350
368213 | UNKNOWN | 100 | 8 | 0x00001388
376032 | CONTRACT_APPLY | 101 | 0 | 0x000003E8
386254 | UNKNOWN | 100 | 1 | 0x00000008
398654 | CONTRACT_APPLY | 1 | 0 | 0x00001388
401742 | MEM_ALLOC | 1 | 0 | 0x00000001
404402 | MEM_ALLOC | 1 | 0 | 0x00000001
406834 | MEM_ALLOC | 1 | 0 | 0x00000001
409233 | MEM_ALLOC | 1 | 0 | 0x00000001
414108 | MEM_EXCEED | 1 | 0 | 0x00000014
417081 | STATE_CHANGE | 1 | 0 | 0x00000001
423230 | MEM_FREE | 1 | 0 | 0x00000001
423284 | MEM_FREE | 1 | 0 | 0x00000001
423311 | MEM_FREE | 1 | 0 | 0x00000001
423334 | MEM_FREE | 1 | 0 | 0x00000001
426025 | JOB_SUBMIT | 1 | 0 | 0x00000003
426395 | STEP_START | 1 | 0 | -
442567 | STEP_END | 1 | 0 | 16107us
445716 | BUDGET_EXCEED | 1 | 0 | 0x00003EEB
446269 | STEP_START | 1 | 1 | -
450636 | STEP_END | 1 | 1 | 4361us
453140 | BUDGET_EXCEED | 1 | 1 | 0x00001109
453191 | STEP_START | 1 | 2 | -
468880 | STEP_END | 1 | 2 | 15683us
471387 | BUDGET_EXCEED | 1 | 2 | 0x00003D43
473801 | JOB_COMPLETE | 1 | 0 | -
487115 | CONTRACT_APPLY | 2 | 0 | 0x00000BB8
489629 | MEM_ALLOC | 2 | 1 | 0x00000001
492318 | MEM_ALLOC | 2 | 1 | 0x00000001
497446 | MEM_EXCEED | 2 | 0 | 0x0000000C
499798 | STATE_CHANGE | 2 | 0 | 0x00000001
502386 | MEM_FREE | 2 | 1 | 0x00000001
502413 | MEM_FREE | 2 | 1 | 0x00000001
504891 | JOB_SUBMIT | 2 | 0 | 0x00000002
504901 | STEP_START | 2 | 0 | -
518357 | STEP_END | 2 | 0 | 13449us
521006 | BUDGET_EXCEED | 2 | 0 | 0x00003489
521029 | STEP_START | 2 | 1 | -
538161 | STEP_END | 2 | 1 | 17125us
540762 | BUDGET_EXCEED | 2 | 1 | 0x000042E5
543055 | JOB_COMPLETE | 2 | 0 | -
558799 | CONTRACT_APPLY | 3 | 0 | 0x000186A0
563722 | JOB_SUBMIT | 3 | 0 | 0x00000003
563733 | STEP_START | 3 | 0 | -
580348 | STEP_END | 3 | 0 | 16607us
580511 | STEP_START | 3 | 1 | -
595893 | STEP_END | 3 | 1 | 15372us
595920 | STEP_START | 3 | 2 | -
611383 | STEP_END | 3 | 2 | 15457us
613929 | JOB_COMPLETE | 3 | 0 | -
=== END DUMP (53 events) ===


--- Interrupt System Demo ---
[demo] waiting ~500ms for timer ticks...
[demo] timer ticks elapsed: 50 (expected ~50 at 100Hz)

--- Round Robin Scheduler Demo ---
=== KERNEL MESH ===
Node 0: (ME) ALIVE Load=0 Heartbeat=0x00000000
===================
[sched] initializing RR scheduler...
[vmm] new user PD at phys 0x0011E000 (virt 0xC011E000)
[vmm] kernel PD at phys 0x00101000 (virt 0xC0101000)
[vmm] kernel_pd[768] = 0x000000E3, new_pd[768] = 0x000000E3
SWCR3OK
SWCR3OK
[kmain] Scheduler active. Idle loop.
[USER] Hello from User Space!
[USER] Hello from User Space!
[USER] Hello from User Space!
[USER] Hello from User Space!
[USER] Hello from User Space!
[USER] Hello from User Space!
[USER] Hello from User Space!
ZE>PSVMHH
KM
ZENEDGE kernel booting...
AI + Edge Computing Kernel Playground

[time] initializing time subsystem
[time] using assumed 1000 MHz CPU frequency
[time] init complete
[trace] flight recorder initialized (256 event ring buffer)
[pmm] initializing physical memory manager
[pmm] mboot at 0x00009500, flags=0x0000024F
[pmm] parsing memory map...
[pmm] found 6 memory regions
[pmm] kernel: phys 0x00100000 - 0x0011A000
[pmm] NUMA node 0: PFN 256-16496 (16214 free)
[pmm] NUMA node 1: PFN 16496-32736 (16240 free)
[pmm] total memory: 130944 KB (32736 pages)
[pmm] free memory: 129816 KB (32454 pages)
[pmm] init complete
[vmm] initializing virtual memory manager
[vmm] current page directory at 0x00101000
[vmm] paging enabled, kernel at 0xC0000000 (boot mapped 128MB using PSE)
[vmm] init complete
[gdt] initializing GDT with TSS...
[gdt] GDT loaded, TSS installed
[idt] initializing IDT...
[idt] IDT loaded with 32 exceptions + 16 IRQs + syscall
[pic] remapping IRQs to vectors 32-47...
[pic] PIC initialized, all IRQs masked
[pit] configuring timer at 100 Hz
[pit] timer configured, IRQ0 unmasked
[keyboard] initialized
[kmain] enabling interrupts...
[syscall] registering syscall handler on vector 128
[pci] Scanning Bus 0...
[pci] Found 0x00008086:0x00001237 at 0:0.0 (Class 0x00000006)
[pci] Found 0x00008086:0x00007000 at 0:1.0 (Class 0x00000006)
[pci] Found 0x00008086:0x00007010 at 0:1.1 (Class 0x00000001)
[pci] Found 0x00008086:0x00007113 at 0:1.3 (Class 0x00000006)
[pci] Found 0x00001234:0x00001111 at 0:2.0 (Class 0x00000003)
[pci] Found 0x00008086:0x0000100E at 0:3.0 (Class 0x00000002)
[pci] Found 0x00001AF4:0x00001110 at 0:4.0 (Class 0x00000005)
[ivshmem] Found device at 0:4.0
[ivshmem] IRQ: 0
[ivshmem] ISR registered on vector 32
[ivshmem] Shared Memory Phys: 0xFE000000 Size: 1048576 bytes
[ivshmem] Mapped to Virt: 0xE0000000
[ipc] initializing proxy driver...
[ipc] cmd ring at 0xE0000000
[ipc] rsp ring at 0xE0008000
[ipc] doorbell at 0xE0010000
[ipc] cmd ring at 0xE0000000
[ipc] rsp ring at 0xE0008000
[ipc] doorbell at 0xE0010000
[heap] initializing shared heap at 0xE0010100
[heap] initialized: 956KB, 15296 blocks
[ipc] Warning: Invalid IRQ, polling mode only.
[ipc] initialized mesh table
[ipc] joined mesh as Node 0

--- IPC Inference Demo ---
[test] Allocated input tensor: id=1
[test] Sending CMD_RUN_MODEL...
[test] Polling for response...
[ipc] response: status=0x00008000 cmd=0x00000010 result=0x00000002
[test] Got response! status=0x00008000 result_blob=0x00000002
[ipc] === DEBUG DUMP ===
[ipc] CMD Ring:
  Magic: 0x51DECA9E (valid)
  Head:  1
  Tail:  1
  Pending: 0 packets
[ipc] RSP Ring:
  Magic: 0x52535030 (valid)
  Head:  1
  Tail:  1
  Pending: 0 responses
[ipc] Doorbell:
  Magic: 0x444F4F52 (valid)
  CMD doorbell: 1 (writes: 1, irqs: 0)
  RSP doorbell: 1 (writes: 1, irqs: 0)
  RSP IRQ enabled: yes
  Local IRQ count: 0
[ipc] === END DUMP ===

--- Shared Heap Demo ---
[test] Allocated raw blob: id=3
[test] Allocated tensor blob: id=5
[test] Wrote 16 floats to tensor
[test] Allocated image tensor: id=7
[heap] === DEBUG DUMP ===
[heap] Magic: 0x48454150 (valid)
[heap] Blocks: 15221/15296 free
[heap] Memory: 4800/978944 bytes used
[heap] Blobs: 4 allocated
  [1] type=1 size=3172 blocks=51
  [3] type=0 size=128 blocks=3
  [5] type=1 size=100 blocks=3
  [7] type=1 size=228 blocks=5
[heap] === END DUMP ===
[test] Freed blob 3
[heap] === DEBUG DUMP ===
[heap] Magic: 0x48454150 (valid)
[heap] Blocks: 15227/15296 free
[heap] Memory: 4416/978944 bytes used
[heap] Blobs: 3 allocated
  [1] type=1 size=3172 blocks=51
  [7] type=1 size=228 blocks=5
  [5] type=1 size=100 blocks=3
[heap] === END DUMP ===

=== MEMORY MAP ===
REGION | BASE       | LENGTH     | TYPE
-------|------------|------------|------------
0      | 0x00000000 | 0x0009FC00 | Available
1      | 0x0009FC00 | 0x00000400 | Reserved
2      | 0x000F0000 | 0x00010000 | Reserved
3      | 0x00100000 | 0x07EE0000 | Available
4      | 0x07FE0000 | 0x00020000 | Reserved
5      | 0xFFFC0000 | 0x00040000 | Reserved

=== NUMA TOPOLOGY ===
Node 0: 64852 KB free / 64960 KB total
Node 1: 64960 KB free / 64960 KB total
=== END MAP ===

[contracts] init
[sched] init

--- Demo 0: Tensor Metadata & Admission Control ---
[test] Job memory metrics:
  total_memory_kb: 12
  peak_memory_kb: 8
  pinned_memory_kb: 4
[contracts] applying contract for job 100
[contracts] priority=HIGH, node=1, cpu_budget=50000us, mem_budget=64KB
[test] Admission check (generous budget):
[admit] checking job 100 against contract for job 100
[admit] job peak memory: 8KB, contract budget: 64KB
[admit] estimated CPU: 5000us, budget: 50000us
[admit] job 100 ADMITTED
  result: OK
[contracts] applying contract for job 101
[contracts] priority=LOW, node=1, cpu_budget=1000us, mem_budget=4KB
[test] Admission check (tight budget):
[admit] checking job 100 against contract for job 101
[admit] job peak memory: 8KB, contract budget: 4KB
[admit] REJECTED: memory budget exceeded
  result: REJECT_MEMORY

--- Demo 1: REALTIME priority job (node 0) ---
[contracts] applying contract for job 1
[contracts] priority=REALTIME, node=0, cpu_budget=5000us, mem_budget=16KB
[test] allocating 5 pages via contract...
  page 0 @ node 0
  page 1 @ node 0
  page 2 @ node 0
  page 3 @ node 0
[contracts] allocation denied: BUDGET EXCEEDED
[contracts] job 1 state: OK -> WARNED
[contracts] Job 1: state=WARNED, cpu=0/5000us, mem=16/16KB
[test] freeing pages...
[sched] run_job begin (budget: 5000us)
[sched] Offloading COMPUTE step 0 to Bridge...
[ipc] response: status=0x00008001 cmd=0x00000010 result=0x00000000
[sched] Step complete. Result: 0x00000000
[sched] Latency Breakdown: Total=5380us (Server=7us, Transport=5373us)
[sched] Remote error status: 0x00008001
